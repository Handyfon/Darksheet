{"name":"Roll Burnout","type":"script","author":"YDXqs2FLgQsthejg","img":"icons/svg/fire.svg","scope":"global","command":"let ActorToRollFor = canvas.tokens.controlled[0].actor;\n// Rolling table, from best to worst\n            const rollings = ['12', '10', '8', '6', '4'];\n            // Value of the burnoutdice\n            let burnoutdie = ActorToRollFor.system.attributes.burnout.value;\n            // find the table\n            let table = game.tables.entities.find(t => t.data.name === \"Burnout Consequence\");\n\t\t\tif(table == undefined){\n\t\t\t\tui.notifications.warn(\"Darksheet | You need to import or create a 'Burnout Consequence' Table to roll from\");\n\t\t\t\treturn;\n\t\t\t}\n            // burnoutsettings\n            let bsettings = ActorToRollFor.system.attributes.burnout.value\n            // magic region\n            var regionmod = parseInt(ActorToRollFor.system.attributes.regionmod.value, 10);\n            //console.log(\"Regionmod: \"+regionmod);\n            // burnoutdice changed through region\n            if (regionmod < 0) {\n                var regionmodz = rollings.indexOf(ActorToRollFor.system.attributes.burnout.value) - parseInt(regionmod);\n                //console.log(\"Regionmodz step2 kleiner: \"+regionmodz);\n                if (regionmodz >= 5) {\n                    regionmodz = 4;\n                }\n            } else {\n                var regionmodz = rollings.indexOf(ActorToRollFor.system.attributes.burnout.value) - parseInt(regionmod);\n                //console.log(\"Regionmodz step3 größer: \"+regionmodz);\n                if (regionmodz <= 0) {\n                    regionmodz = 0;\n                }\n            }\n            var burnoutARegion = rollings[regionmodz];\n\n            let rollcon = burnoutARegion;\n            let rollcona = \"d\" + rollcon\n            let roll = new Roll(`${rollcona}`).roll();\n            let result = await table.roll();\n\t\t\t//NEW BURNOUT DIE\n\t\t\tif(burnoutARegion == 4)\n\t\t\t\tvar newBurnOutDie = \"\";\n\t\t\telse\n\t\t\t\tvar newBurnOutDie = \"-> d\" + rollings[regionmodz +1];\n\n            if (burnoutdie === 0) {} else {\n                let content = `\n\t\t\t\t<div class=\"dnd5e chat-card item-card\" data-acor-id=\"${ActorToRollFor._id}\">\n\t\t\t\t\t<header class=\"card-header flexrow\">\n\t\t\t\t\t\t<img src=\"${ActorToRollFor.data.token.img}\" title=\"\" width=\"36\" height=\"36\" style=\"border: none;\"/>\n\t\t\t\t\t\t<h3>Burnoutdice(${rollcona}) - </h3>\n\t\t\t\t\t<h3><div class=\"burnoutDiceChatValue\">${roll.result}</div></h3>\n\t\t\t\t\t</header>\n\t\t\t\t</div>`;\n                let content2 = `\n\t\t\t\t<div class=\"dnd5e chat-card item-card\" data-acor-id=\"${ActorToRollFor._id}\">\n\t\t\t\t\t<header class=\"card-header flexrow\">\n\t\t\t\t\t\t<img src=\"${ActorToRollFor.data.token.img}\" title=\"\" width=\"36\" height=\"36\" style=\"border: none;\"/>\n\t\t\t\t\t\t<h3>Burnoutdice(${rollcona}) ${newBurnOutDie} - </h3>\n\t\t\t\t\t<h3 style=\"color: #ff0000;text-shadow: 0 0 2px;\"><div class=\"burnoutDiceChatValue\">${roll.result}</div></h3>\n\t\t\t\t\t</header>\n\t\t\t\t\t</br>\n\t\t\t\t\t<h3 style=\"color: #ff0000;text-shadow: 0 0 2px; text-align: center;\">${result.results[0].data.text}</h3>\n\t\t\t\t</div>`;\n                let content3 = `\n\t\t\t\t<div class=\"dnd5e chat-card item-card\" data-acor-id=\"${ActorToRollFor._id}\">\n\t\t\t\t\t<header class=\"card-header flexrow\">\n\t\t\t\t\t\t<img src=\"${ActorToRollFor.data.token.img}\" title=\"\" width=\"36\" height=\"36\" style=\"border: none;\"/>\n\t\t\t\t\t\t<h3>Burnoutdice(${rollcona}): </h3>\n\t\t\t\t\t<h3 style=\"color: #ff0000;text-shadow: 0 0 2px;\"><div class=\"burnoutDiceChatValue\">${roll.result}</div></h3>\n\t\t\t\t\t</header>\n\t\t\t\t</div>`;\n                let rollWhisper = null;\n                let rollBlind = false;\n                let rollMode = game.settings.get(\"core\", \"rollMode\");\n                if ([\"gmroll\", \"blindroll\"].includes(rollMode)) rollWhisper = ChatMessage.getWhisperRecipients(\"GM\")\n                if (rollMode === \"blindroll\") rollBlind = true;\n                if (roll.result <= 2) {\n                    if (bsettings) {\n                        ChatMessage.create({\n                            user: game.user._id,\n                            content: content2,\n                            speaker: {\n                                actor: ActorToRollFor._id,\n                                token: ActorToRollFor.token,\n                                alias: ActorToRollFor.name\n                            },\n\n                            sound: CONFIG.sounds.dice,\n                            flags: {\n                                darksheet: {\n                                    outcome: 'bad'\n                                }\n                            }\n                        });\n                    } else {\n                        ChatMessage.create({\n                            user: game.user._id,\n                            content: content3,\n                            speaker: {\n                                actor: ActorToRollFor._id,\n                                token: ActorToRollFor.token,\n                                alias: ActorToRollFor.name\n                            },\n\n                            sound: CONFIG.sounds.dice,\n                            flags: {\n                                darksheet: {\n                                    outcome: 'bad'\n                                }\n                            }\n                        });\n                    }\n                    // Lower burnoutdie rank\n                    const new_burnoutdie = rollings.indexOf(ActorToRollFor.system.attributes.burnout.value) + 1;\n                    if (new_burnoutdie < rollings.length) {\n\t\t\t\t\t    ActorToRollFor.update({'data.attributes.burnout.value': rollings[new_burnoutdie]});\n                    }\n                    this.render();\n                } else {\n                    ChatMessage.create({\n                        user: game.user._id,\n                        content: content,\n                        speaker: {\n                            actor: ActorToRollFor._id,\n                            token: ActorToRollFor.token,\n                            alias: ActorToRollFor.name\n                        },\n                        sound: CONFIG.sounds.dice\n                    });\n                }\n            }","folder":null,"sort":0,"permission":{"default":0,"YDXqs2FLgQsthejg":3},"flags":{"core":{"sourceId":"Macro.85pgraQVRb9jfwJB"}},"_id":"wuzor4tB6O1g1kTJ"}
